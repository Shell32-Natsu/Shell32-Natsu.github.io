# This is a basic workflow to help you get started with Actions

name: issues

# Controls when the action will run. Triggers the workflow on push or pull request
# events but only for the src branch
on:
  issues:
    types: [opened, edited]

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v2
    
    - name: Get Issue Info
      id: issue-info
      env:
        ISSUE: ${{toJson(github.event.issue)}}
      run: |
        ISSUE="${ISSUE//$'\n'}"
        echo "::set-output name=issue::$ISSUE"

    - name: Generate article
      id: generate-article
      uses: Shell32-Natsu/blog-article-from-issue-action@v1
      with:
        issueJson: ${{ steps.issue-info.outputs.issue }}
        
    - name: Show article
      run: echo "${{ steps.generate-article.outputs.article }}"
    
    - name: Write to file
      run: |
        FILE="source/_posts/${{ github.event.issue.title }}.md"
        if [[ -f "$FILE" ]]; then
          echo "$FILE" has already existed.
          exit 1
        fi
        echo "${{ steps.generate-article.outputs.article }}" >> "$FILE"
        
    - name: Commit and Push
      run: |
        git config --global user.name 'Donny Xia'
        git config --global user.email 'shell32-natsu@users.noreply.github.com'
        git add --all
        git commit -am "Add artivle ${{ github.event.issue.title }}"
        git push
      
